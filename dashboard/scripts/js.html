<!-- JavaScript -->
<script>
    const thaiMonths = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];
    const today = new Date();
    const formattedDate = `${today.getDate()} ${thaiMonths[today.getMonth()]} ${today.getFullYear() + 543}`;
    document.getElementById('start-date').textContent = formattedDate;


    function getStatusByKey(key, v, min, max) {
        if (v >= min && v <= max) return { text: 'ดีที่สุด', type: 'success' };
        if (v > max) return { text: 'เหมาะสม', type: 'success' };
        if (v >= min && v <= max) return { text: 'ไม่ดี', type: 'warning' };
        return { text: 'อันตราย', type: 'danger' };

    }

    function setBadge(statusEl, text, type) {
        const map = {
            success: 'status px-2 py-0.5 rounded-full bg-green-100 text-green-600 text-[9px] font-bold uppercase',
            warning: 'status px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 text-[9px] font-bold uppercase',
            danger: 'status px-2 py-0.5 rounded-full bg-red-100 text-red-600 text-[9px] font-bold uppercase',
            info: 'status px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-[9px] font-bold uppercase',
            na: 'status px-2 py-0.5 rounded-full bg-stone-100 text-stone-500 text-[9px] font-bold uppercase',
            orange: 'status px-2 py-0.5 rounded-full bg-orange-100 text-orange-700 text-[9px] font-bold uppercase',
        };

        statusEl.textContent = text;
        statusEl.className = map[type] || map.na;
    }

    function setCardValue(key, value, min, max) {
        const card = document.getElementById(`card-${key}`);
        if (!card) return;

        const valueEl = card.querySelector('.value');
        const statusEl = card.querySelector('.status');


        if (value === null || value === undefined || isNaN(value)) {
            valueEl.textContent = '--';
            setBadge(statusEl, 'N/A', 'na');
            return;
        }

        const v = Number(value);


        valueEl.textContent = v.toLocaleString('en-US', {
            minimumFractionDigits: 0,
            maximumFractionDigits: 2
        });

        const st = getStatusByKey(key, v, min, max);
        setBadge(statusEl, st.text, st.type);

        updateMetricBar(key, v);
    }

    //=============== Bar Process ==================

    function initMetricBars() {
        document.querySelectorAll('.metric-range').forEach(wrap => {
            const key = wrap.dataset.key;
            const min = wrap.dataset.min;
            const max = wrap.dataset.max;
            // const cfg = BAR_CONFIG[key];

            wrap.classList.remove('hidden');

            const left = wrap.querySelector('.label-left');
            const right = wrap.querySelector('.label-right');
            left.textContent = min || '';
            right.textContent = max || '';
            left.style.color = '#C73434';
            right.style.color = '#198754';

            const fill = wrap.querySelector('.fill');
            if (fill) fill.style.clipPath = 'inset(0 100% 0 0)';
        });
    }

    function updateMetricBar(key, value) {
        // const cfg = BAR_CONFIG[key];
        // if (!cfg) return;

        const wrap = document.querySelector(`.metric-range[data-key="${key}"]`);
        if (!wrap) return;

        const min = wrap.dataset.min;
        const max = wrap.dataset.max;

        const fill = wrap.querySelector('.fill');

        if (value === null || value === undefined || isNaN(value)) {
            if (fill) fill.style.clipPath = 'inset(0 100% 0 0)';
            return;
        }

        const v = Number(value);
        const pct = ((v - min) / (max - min)) * 100;
        const safePct = clamp(pct, 0, 100);

        if (fill) {
            // fill.style.clipPath = `inset(0 ${100 - safePct}% 0 0)`;
            fill.style.clipPath = `inset(0 50% 0 0)`;
        }
    }

    //=============== Function Calc ==================
    function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
    }

    function toNumber(v) {
        const n = parseFloat(v);
        return Number.isFinite(n) ? n : 0;
    }

    function formatNumber(n) {
        return (Number.isFinite(n) ? n : 0).toFixed(1);
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    function Min(list) {
        if (!Array.isArray(list)) return 0;
        let min = Math.min(list);
        return min;
    }

    function Max(list) {
        if (!Array.isArray(list)) return 0;
        let max = Math.max(list);
        return max;
    }

    function Avg(list) {
        if (!Array.isArray(list)) return 0;
        const avg = (Sum(list) / list.length).toFixed(2);
        return avg;
    }

    function Sum(list) {
        if (!Array.isArray(list)) return 0;
        let sum = 0;
        list.forEach(v => {
            sum += v;
        });
        return sum;
    }

</script>